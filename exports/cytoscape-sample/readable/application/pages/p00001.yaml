---
# ====== Page: ホーム ========================================
id: 1
identification: 
  name: ホーム
  alias: HOME
  title: Cytoscape Sample

appearance: 
  page-mode: Normal
  page-template: Theme Default
  template-options: 
  - '#DEFAULT#'

navigation-menu: 
  override-user-interface-level: false

navigation: 
  cursor-focus: Do not focus cursor
  warn-on-unsaved-changes: true

javascript: 
  file-urls: 
  - 'https://unpkg.com/cytoscape@3.23.0/dist/cytoscape.min.js'
  function-and-global-variable-declaration: |
    var cy;
    
    const RENDER_CY = {
        name: "render-cy",
        action: (event, element, args) => {
            let result = apex.server.process("GET_DATA", {
                x01: "get_data"
            });
            result.done( (data) => {
                cy = cytoscape({
                    container: document.getElementById('cy'), // container to render in
                    elements: data.elements,
                    style: data.style,
                    layout: {
                        name: 'grid',
                        rows: 1
                    }
                })
            });
        }
    };
  execute-when-page-loads: apex.actions.add([RENDER_CY]);

css: 
  inline: |
    #cy {
      width: 300px;
      height: 300px;
      display: block;
    }

security: 
  authentication: Page Requires Authentication
  deep-linking: Application Default
  page-access-protection: Arguments Must Have Checksum
  form-auto-complete: Off
  browser-cache: Application Default

session-management: 
  rejoin-sessions: Application Default

advanced: 
  enable-duplicate-page-submissions: Yes - Enable page to be re-posted
  reload-on-submit: Only for Success

server-cache: 
  caching: Disabled

regions: 
- # ====== Region: Cytoscape ===================================
  id: 36488188239314730
  identification: 
    title: Cytoscape
    type: 静的コンテンツ

  source: 
    html-code: <div id="cy"></div>

  layout: 
    sequence: 10
    parent-region: No Parent
    position: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes # 39078311803683949
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: true
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      出力形式: HTML
      ショートカットを開く: false

- # ====== Region: Cytoscape Sample ============================
  id: 39253271448684063
  identification: 
    title: Cytoscape Sample
    type: 静的コンテンツ

  layout: 
    sequence: 10
    parent-region: No Parent
    position: REGION_POSITION_01
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Hero # 39111399418683966
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  image: 
    file-url: '#APP_FILES#icons/app-icon-512.png'

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      出力形式: HTML
      ショートカットを開く: false

buttons: 
- # ====== Button: RENDER ======================================
  id: 36488371713314732
  identification: 
    button-name: RENDER
    label: Render

  layout: 
    sequence: 10
    region: Cytoscape # 36488188239314730
    position: NEXT
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text # 39217273845684021
    hot: false
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    custom-attributes: 
    - data-action="#action$render-cy"

processes: 
- # ====== Process: GET_DATA ===================================
  id: 36488280454314731
  identification: 
    name: GET_DATA
    type: コードを実行

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      declare
          l_response clob;
          l_response_json json_object_t;
          l_data_array json_array_t;
          l_data       json_object_t;
          l_style_array   json_array_t;
          l_style    json_object_t;
      begin
          /* elementsの作成 */
          l_data_array := json_array_t();
          l_data := json_object_t();
          l_data.put('data', json_object_t(
              json_object(
                  'id' value 'a'
          )));
          l_data_array.append(l_data);
          l_data := json_object_t();
          l_data.put('data', json_object_t(
              json_object(
                  'id' value 'b'
          )));
          l_data_array.append(l_data);
          l_data := json_object_t();
          l_data.put('data', json_object_t(
              json_object(
                  'id' value 'ab'
                  ,'source' value 'a'
                  ,'target' value 'b'
          )));
          l_data_array.append(l_data);
          /* sytleの作成 */
          l_style_array := json_array_t();
          l_style := json_object_t();
          l_style.put('style', json_object_t(
              json_object(
                  'background-color' value '#666'
                  ,'label' value 'data(id)'
          )));
          l_style_array.append(l_style);
          l_style := json_object_t();
          l_style.put('selector','node');
          l_style.put('style', json_object_t(
              json_object(
                  'background-color' value '#666'
                  ,'label' value 'data(id)'
          )));
          l_style_array.append(l_style);
          l_style := json_object_t();
          l_style.put('selector','edge');
          l_style.put('style', json_object_t(
              json_object(
                  'width' value 3
                  ,'line-color' value '#ccc'
                  ,'target-arrow-color' value '#ccc'
                  ,'target-arrow-shape' value 'triangle'
                  ,'curve-style' value 'bezier'
          )));
          l_style_array.append(l_style);
          /* 応答となるJSONを生成 */
          l_response_json := json_object_t();
          l_response_json.put('elements', l_data_array);
          l_response_json.put('style', l_style_array);
          l_response := l_response_json.to_clob();
          apex_debug.info(l_response);
          htp.p(l_response);
      end;

  execution: 
    sequence: 10
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

